<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Villa Availability Checker</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 15px;
      max-width: 900px;
      margin: auto;
    }

    h2 {
      text-align: center;
      margin-bottom: 20px;
    }

    .input-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin-bottom: 15px;
    }
input[type="date"]::-webkit-calendar-picker-indicator {
    position: absolute;
    height: auto;
    width: auto;
    left: 0;
    top: 0;
    bottom: 0;
    right: 0;
    background: transparent;
}
    input[type="date"], button {
      padding: 24px;
      font-size: 24px;
      border-radius: 6px;
      border: 1px solid #ccc;
      width: 100%;
      position: relative;
    }
input#checkin:before {
    content: "check-in";
    position: absolute;
    top: 6px;
    left: 24px;
    font-size: 14px;
}
input#checkout:before {
    content: "check-out";
    position: absolute;
    top: 6px;
    left: 24px;
    font-size: 14px;
}
    button {
      background: #007bff;
      color: white;
      cursor: pointer;
      border: none;
    }

    button:hover {
      background: #0056b3;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 15px;
    }

    th, td {
      padding: 10px;
      border: 1px solid #ddd;
      text-align: center;
    }

    .available {
      background: #c6f7d0;
      color: #006400;
      font-weight: bold;
    }

    .booked {
      background: #ffbfbf;
      color: #8b0000;
      font-weight: bold;
    }

    #loading {
      display: none;
      text-align: center;
      margin-top: 10px;
      color: #666;
    }

    /* ðŸ“± MOBILE FRIENDLY */
    @media (max-width: 600px) {
      table, thead, tbody, th, td, tr {
        font-size: 13px;
      }
      th, td {
        padding: 6px;
      }
    }

    @media screen and (max-width: 600px) {
  table {
    border: 0;
  }
  td[data-label="Date"]
 {
    font-size: 14px;
    font-weight: bold;
    background: #000;
    color: #fff;
}
  table caption {
    font-size: 1.3em;
  }
  
  table thead {
    border: none;
    clip: rect(0 0 0 0);
    height: 1px;
    margin: -1px;
    overflow: hidden;
    padding: 0;
    position: absolute;
    width: 1px;
  }
  
  table tr {
    border-bottom: 3px solid #ddd;
    display: block;
    margin-bottom: .625em;
  }
  
  table td {
    border-bottom: 1px solid #ddd;
    display: block;
    font-size: .8em;
    text-align: right;
  }
  
  table td::before {
    /*
    * aria-label has no advantage, it won't be read inside a table
    content: attr(aria-label);
    */
    content: attr(data-label);
    float: left;
    font-weight: bold;
    text-transform: uppercase;
  }
  
  table td:last-child {
    border-bottom: 0;
  }
}

  </style>
</head>
<body>

  <h2>Ketersediaan Awana Farmhouse Dieng</h2>

  <div class="input-group">
    <input type="date" id="checkin">
    <input type="date" id="checkout">
    <button id="checkBtn">Check Availability</button>
  </div>

  <div id="loading">Loading data...</div>

  <table id="availabilityTable">
    <thead>
      <tr>
        <th scope="col">Date</th>
        <th scope="col">Season</th>
        <th scope="col">Omah Lor</th>
        <th scope="col">Omah Kidul</th>
        <th scope="col">Omah Wetan</th>
        <th scope="col">Omah Kulon</th>
      </tr>
    </thead>
    <tbody>
      <tr><td colspan="6" style="text-align: center;">Please select check-in and check-out dates.</td></tr>
    </tbody>
  </table>

<script>

const API_URL = "https://script.google.com/macros/s/AKfycbwH1_S9bIQ8YtV5OihsxJknCXGuTmHTiU4Sk_7EW9jWT2QHFuTEZ0MGnRa7E1tOhzh1pQ/exec";

let sheetData = [];

/* Normalize YYYY-MM-DD to JS Date (local timezone) */
function normalizeDate(dateString) {
  if (!dateString) return null;
  const [y, m, d] = dateString.split("-");
  return new Date(y, m - 1, d);
}

/* Human format: Senin, 10 Januari */
function formatHumanDate(dateString) {
  const d = normalizeDate(dateString);
  if (!d) return dateString;

  const days = ["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"];
  const months = [
    "Januari","Februari","Maret","April","Mei","Juni",
    "Juli","Agustus","September","Oktober","November","Desember"
  ];

  return `${days[d.getDay()]}, ${d.getDate()} ${months[d.getMonth()]}`;
}



/* Fetch data + enable button after loaded */
async function loadData() {
  const checkBtn = document.getElementById("checkBtn");

  try {
    const res = await fetch(API_URL);
    const json = await res.json();

    sheetData = json.data;

    checkBtn.classList.add("enabled");
  } catch (err) {
    console.error("Fetch error:", err);
    document.querySelector("#availabilityTable tbody").innerHTML =
      "<tr><td colspan='6'>Error loading data.</td></tr>";
  }

  document.getElementById("loading").style.display = "none";
}

function checkStatus(val) {
  return (val === "" || val === null || val === undefined)
    ? "Available"
    : "Booked";
}

function renderTable(filtered) {
  const tbody = document.querySelector("#availabilityTable tbody");
  tbody.innerHTML = "";

  if (filtered.length === 0) {
    tbody.innerHTML = "<tr><td colspan='6'>No dates found.</td></tr>";
    return;
  }

  filtered.forEach(row => {
    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td data-label="Date">${formatHumanDate(row.date)}</td>
      <td data-label="Season">${row.Season || "-"}</td>
      <td data-label="Omah Lor" class="${checkStatus(row["Omah Lor"]).toLowerCase()}">${checkStatus(row["Omah Lor"])}</td>
      <td data-label="Omah Kidul" class="${checkStatus(row["Omah Kidul"]).toLowerCase()}">${checkStatus(row["Omah Kidul"])}</td>
      <td data-label="Omah Wetan" class="${checkStatus(row["Omah Wetan"]).toLowerCase()}">${checkStatus(row["Omah Wetan"])}</td>
      <td data-label="Omah Kulon" class="${checkStatus(row["Omah Kulon"]).toLowerCase()}">${checkStatus(row["Omah Kulon"])}</td>
    `;

    tbody.appendChild(tr);
  });
}

function filterByDate() {
  const ci = document.getElementById("checkin").value;
  const co = document.getElementById("checkout").value;

  if (!ci || !co) {
    alert("Please select both check-in and check-out dates.");
    return;
  }

  const start = normalizeDate(ci);
  const end = normalizeDate(co);

  const filtered = sheetData.filter(row => {
    const d = normalizeDate(row.date);
    return d >= start && d < end;  // checkout not included
  });

  renderTable(filtered);
}

document.getElementById("checkBtn").addEventListener("click", filterByDate);

document.getElementById("checkin").addEventListener("change", function () {
  const checkinDate = new Date(this.value);
  const checkout = document.getElementById("checkout");

  // Minimum checkout = next day
  const minDate = new Date(checkinDate);
  minDate.setDate(minDate.getDate() + 1);

  // Maximum checkout = check-in + 14 days
  const maxDate = new Date(checkinDate);
  maxDate.setDate(maxDate.getDate() + 14);

  checkout.min = minDate.toISOString().split("T")[0];
  checkout.max = maxDate.toISOString().split("T")[0];

  // Reset checkout if outside new limits
  if (checkout.value && (checkout.value < checkout.min || checkout.value > checkout.max)) {
    checkout.value = "";
  }
});

loadData();

</script>

</body>
</html>
