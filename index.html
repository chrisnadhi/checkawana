<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Villa Availability Checker</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 10px; border: 1px solid #ccc; text-align: center; }
    .available { background: #c6f7d0; }
    .booked { background: #ffbfbf; }
    input, button { padding: 10px; margin-right: 10px; }
    button { cursor: pointer; }
  </style>
</head>
<body>

  <h2>Villa Availability Checker</h2>

  <label>Check-in: </label>
  <input type="date" id="checkin">

  <label>Check-out: </label>
  <input type="date" id="checkout">

  <button id="checkBtn">Check Availability</button>

  <table id="availabilityTable">
    <thead>
      <tr>
        <th>Date</th>
        <th>Season</th>
        <th>Room A</th>
        <th>Room B</th>
        <th>Room C</th>
        <th>Room D</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbwH1_S9bIQ8YtV5OihsxJknCXGuTmHTiU4Sk_7EW9jWT2QHFuTEZ0MGnRa7E1tOhzh1pQ/exec";

    // Load data on start
    let sheetData = [];

    async function loadData() {
      const res = await fetch(API_URL);
      const json = await res.json();
      sheetData = json.data;
    }

    function renderTable(data) {
      const tbody = document.querySelector("#availabilityTable tbody");
      tbody.innerHTML = "";

      if (data.length === 0) {
        tbody.innerHTML = "<tr><td colspan='6'>No data found for selected dates</td></tr>";
        return;
      }

      data.forEach(row => {
        const tr = document.createElement("tr");

        tr.innerHTML = `
          <td>${row.date}</td>
          <td>${row.season}</td>
          <td class="${getClass(row['room a'])}">${row['room a']}</td>
          <td class="${getClass(row['room b'])}">${row['room b']}</td>
          <td class="${getClass(row['room c'])}">${row['room c']}</td>
          <td class="${getClass(row['room d'])}">${row['room d']}</td>
        `;

        tbody.appendChild(tr);
      });
    }

    function getClass(status) {
      if (!status) return "";
      return status.toLowerCase().includes("available") ? "available" : "booked";
    }

    function filterByDateRange() {
      const checkin = document.getElementById("checkin").value;
      const checkout = document.getElementById("checkout").value;

      if (!checkin || !checkout) {
        alert("Please select both check-in and check-out dates.");
        return;
      }

      const filtered = sheetData.filter(row => {
        const rowDate = new Date(row.date);
        return rowDate >= new Date(checkin) && rowDate <= new Date(checkout);
      });

      renderTable(filtered);
    }

    document.getElementById("checkBtn").addEventListener("click", filterByDateRange);

    loadData();
  </script>

</body>
</html>
